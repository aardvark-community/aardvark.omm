cmake_minimum_required(VERSION 3.15)

project(omm-sdk LANGUAGES CXX)
if(WIN32)
    set(OS windows)
    SET(ARCH AMD64)
    set(CMAKE_MSVC_RUNTIME_LIBRARY "MultiThreaded$<$<CONFIG:Debug>:Debug>")
    set(OMM_LIB_NAME "Release/omm-lib.dll")
    set(OMM_LIB_RENAME "omm-lib.dll")
elseif(APPLE)
    set(OS mac)
    execute_process(COMMAND uname -m OUTPUT_VARIABLE ARCH)
    string(REGEX REPLACE "\n$" "" ARCH "${ARCH}")
    string(REGEX REPLACE "x86_64" "AMD64" ARCH "${ARCH}")
    set(OMM_LIB_NAME "libomm-lib.dylib")
    set(OMM_LIB_RENAME "libomm-lib.dylib")
elseif(UNIX AND NOT APPLE)
    set(OS linux)
    execute_process(COMMAND uname -m OUTPUT_VARIABLE ARCH)
    string(REGEX REPLACE "\n$" "" ARCH "${ARCH}")
    string(REGEX REPLACE "x86_64" "AMD64" ARCH "${ARCH}")
    set(OMM_LIB_NAME "libomm-lib.so.1.8.0")
    set(OMM_LIB_RENAME "libomm-lib.so")
else()
    set(OS unknown)
    SET(ARCH AMD64)
endif(WIN32)

SET(CMAKE_INSTALL_PREFIX "${CMAKE_CURRENT_SOURCE_DIR}/../lib/Native/Aardvark.OMM/")

set(OMM_ENABLE_TESTS OFF CACHE BOOL "")
set(OMM_BUILD_VIEWER OFF CACHE BOOL "")
set(OMM_INTEGRATION_LAYER_NVRHI OFF CACHE BOOL "")
set(OMM_ENABLE_PRECOMPILED_SHADERS_DXIL OFF CACHE BOOL "")
set(OMM_LIB_INSTALL OFF CACHE BOOL "")
add_subdirectory("omm-sdk")

install(FILES "build/bin/${OMM_LIB_NAME}" RENAME "${OMM_LIB_RENAME}" DESTINATION ${OS}/${ARCH})